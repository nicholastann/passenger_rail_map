<!doctype html>
<html>
  <head>
    <title>Rail Visualizer</title>

    <script>(g=>{var h,a,k,p="The Google Maps JavaScript API",c="google",l="importLibrary",q="__ib__",m=document,b=window;b=b[c]||(b[c]={});var d=b.maps||(b.maps={}),r=new Set,e=new URLSearchParams,u=()=>h||(h=new Promise(async(f,n)=>{await (a=m.createElement("script"));e.set("libraries",[...r]+"");for(k in g)e.set(k.replace(/[A-Z]/g,t=>"_"+t[0].toLowerCase()),g[k]);e.set("callback",c+".maps."+q);a.src=`https://maps.${
    c}apis.com/maps/api/js?`+e;d[q]=f;a.onerror=()=>h=n(Error(p+" could not load."));a.nonce=m.querySelector("script[nonce]")?.nonce||"";m.head.append(a)}));d[l]?console.warn(p+" only loads once. Ignoring:",g):d[l]=(f,...n)=>r.add(f)&&u().then(()=>d[l](f,...n))})
        ({key: "AIzaSyB4VCP1TCMdfDjymXRoSyYlcoTTThpwTHM", v: "weekly"});</script>
    <script>

            const cities = [
            {city:"New York", population:8258035, lat:40.66, long:-73.94},
            {city:"Los Angeles", population:3820914, lat:34.02, long:-118.41},
            {city:"Chicago", population:2664452, lat:41.84, long:-87.68},
            {city:"Houston", population:2314157, lat:29.79, long:-95.39},
            {city:"Phoenix", population:1650070, lat:33.57, long:-112.09},
            {city:"Philadelphia", population:1750542, lat:40.01, long:-75.13},
            {city:"San Antonio", population:1495295, lat:29.46, long:-98.52},
            {city:"San Diego", population:1388320 , lat:32.81, long:-117.14},
            {city:"Dallas", population:1302868, lat:32.79, long:-96.77},
            {city:"Jacksonville", population:985843, lat:30.34, long:-81.66},
            {city:"Austin", population:979882, lat:30.30, long:-97.75},
            {city:"Fort Worth", population:978468, lat:32.78, long:-97.35},
            {city:"San Jose", population:969655, lat:37.30, long:-121.81},
            {city:"Columbus Ohio", population:913175, lat:39.99, long:-82.99},
            {city:"Charlotte", population:911311, lat:35.21, long:-80.83},
            {city:"Indianapolis", population:879293, lat:39.78, long:-86.15},
            {city:"San Francisco", population:808988, lat:37.73, long:-123.03},
            {city:"Seattle", population:755078 , lat:47.62, long:-122.35},
            {city:"Denver", population:716577, lat:39.76, long:-104.88},
            {city:"Oklahoma City", population:702767 , lat:35.47, long:-97.51},
            {city:"Nashville", population:687788 , lat:36.17, long:-86.79},
            {city:"Washington", population:678972, lat:38.90, long:-77.02},
            {city:"El Paso", population:678958, lat:31.85, long:-106.43},
            {city:"Las Vegas", population:660929, lat:36.23, long:-115.26},
            {city:"Boston", population:653833, lat:42.34, long:-71.02},
            {city:"Detroit", population:633218 , lat:42.38, long:-83.10},
            {city:"Portland", population:630498, lat:45.54, long:-122.65},
            {city:"Louisville", population:622981, lat:8.17, long:-85.65},
            {city:"Memphis", population:618639 , lat:35.11, long:-89.97},
            {city:"Baltimore", population:565239, lat:39.30, long:-76.61},
            {city:"Milwaukee", population:561385, lat:43.06, long:-87.97},
            {city:"Albuquerque", population:560274 , lat:35.10, long:-106.65},
            {city:"Tucson", population:547239, lat:32.15, long:-110.87},
            {city:"Fresno", population:545716, lat:36.78, long:-119.79},
            {city:"Sacramento", population:526384, lat:38.57, long:-121.47},
            {city:"Mesa", population:511648, lat:33.40, long:-111.72},
            {city:"Atlanta", population:510823 , lat:33.76, long:-84.42},
            {city:"Kansas City", population:510704 , lat:39.12, long:-94.56},
            {city:"Colorado Springs", population:488664, lat:38.87, long:-104.76},
            {city:"Omaha", population:483335, lat:41.26, long:-96.05},
            {city:"Raleigh", population:482295 , lat:35.83, long:-78.64},
            {city:"Miami", population:455924, lat:25.78, long:-80.21},
            {city:"Virginia Beach", population:453649, lat:36.78, long:-76.03},
            {city:"Long Beach", population:449468, lat:33.78, long:-118.17},
            {city:"Oakland", population:436504 , lat:37.77, long:-122.23},
            {city:"Minneapolis", population:425115 , lat:44.96, long:-93.27},
            {city:"Bakersfield", population:413381, lat:35.35, long:-119.04},
            {city:"Tulsa", population:411894, lat:36.13, long:-95.90},
            {city:"Tampa", population:403364, lat:27.97, long:-82.47},
            {city:"Arlington", population:398431, lat:32.70, long:-97.12},
            {city:"Wichita", population:396119, lat:37.69, long:-97.35},
            {city:"Aurora", population:395052, lat:39.70, long:-104.72},
            {city:"New Orleans", population:364136, lat:30.05, long:-89.93},
            {city:"Cleveland", population:362656, lat:41.48, long:-81.68},
            {city:"Anaheim", population:340512, lat:33.86, long:-117.76},
            {city:"Henderson", population:337305, lat:36.01, long:-115.04},
            {city:"Orlando", population:320742, lat:28.41, long:-81.25},
            {city:"Lexington", population:320154, lat:38.04, long:-84.46},
            {city:"Stockton", population:319543, lat:37.98, long:-121.31},
            {city:"Riverside", population:318858, lat:33.94, long:-117.39},
            {city:"Corpus Christi", population:316595, lat:27.75, long:-97.17},
            {city:"Irvine", population:314621, lat:33.68, long:-117.77},
            {city:"Cincinnati", population:311097, lat:39.14, long:-84.51},
            {city:"Santa Ana", population:310539, lat:33.74, long:-117.88},
            {city:"Newark", population:304960, lat:40.72, long:-74.17},
            {city:"Saint Paul", population:303820, lat:44.95, long:-93.10},
            {city:"Pittsburgh", population:303255, lat:40.44, long:-79.98},
            {city:"Greensboro", population:302296, lat:36.10, long:-79.83},
            {city:"Durham", population:296186, lat:35.98, long:-78.90},
            {city:"Lincoln", population:294757, lat:40.81, long:-96.68},
            {city:"Jersey City", population:291657, lat:40.71, long:-74.06},
            {city:"Plano", population:290190, lat:33.05, long:-96.75},
            {city:"North Las Vegas", population:284771, lat:36.28, long:-115.09},
            {city:"St. Louis", population:281754, lat:38.64, long:-90.24},
            {city:"Madison", population:280305, lat:43.09, long:-89.43},
            {city:"Chandler", population:280167, lat:33.28, long:-111.85},
            {city:"Gilbert", population:275411, lat:33.31, long:-111.74},
            {city:"Reno", population:274915, lat:39.55, long:-119.85},
            {city:"Buffalo", population:274678, lat:42.89, long:-78.86},
            {city:"Chula Vista", population:274333, lat:32.63, long:-117.02},
            {city:"Fort Wayne", population:269994, lat:41.09, long:-85.14},
            {city:"Lubbock", population:266878, lat:33.57, long:-101.89},
            {city:"Toledo", population:265304, lat:41.66, long:-83.58},
            {city:"St. Petersburg", population:263553, lat:27.77, long:-82.64},
            {city:"Laredo", population:257602, lat:27.56, long:-99.49},
            {city:"Irving", population:254373, lat:32.86, long:-96.97},
            {city:"Chesapeake", population:253886, lat:36.68, long:-76.30},
            {city:"Glendale", population:253855, lat:33.53, long:-112.19},
            {city:"Winston-Salem", population:252975, lat:36.10, long:-80.26},
            {city:"Port St. Lucie", population:245021, lat:27.28, long:-80.39},
            {city:"Scottsdale", population:244394, lat:33.68, long:-111.86},
            {city:"Garland", population:243470, lat:32.91, long:-96.63},
            {city:"Boise", population:235421, lat:43.60, long:-116.23},
            {city:"Norfolk", population:230930, lat:36.92, long:-76.24},
            {city:"Spokane", population:229447, lat:47.67, long:-117.43},
            {city:"Richmond", population:229247, lat:37.53, long:-77.48},
            {city:"Fremont", population:226208, lat:37.49, long:-121.94},
            {city:"Huntsville", population:225564, lat:34.78, long:-86.53},
            {city:"Frisco", population:225007, lat:33.16, long:-96.82},
            {city:"Cape Coral", population:224455, lat:26.65, long:-81.99},
            {city:"Santa Clarita", population:224028, lat:34.41, long:-118.49},
            {city:"San Bernardino", population:223728, lat:34.14, long:-117.29},
            {city:"Tacoma", population:222906, lat:47.25, long:-122.46},
            {city:"Hialeah", population:221300, lat:25.87, long:-80.30},
            {city:"Baton Rouge", population:219573, lat:30.44, long:-91.13},
            {city:"Modesto", population:218915, lat:37.64, long:-121.00},
            {city:"Fontana", population:215465, lat:34.11, long:-117.46},
            {city:"McKinney", population:213509, lat:33.20, long:-96.66},
            {city:"Moreno Valley", population:212392, lat:33.92, long:-117.21},
            {city:"Des Moines", population:210381, lat:41.57, long:-93.61},
            {city:"Fayetteville", population:209749, lat:35.08, long:-78.97},
            {city:"Salt Lake City", population:209593, lat:40.78, long:-111.93},
            {city:"Yonkers", population:207657, lat:40.95, long:-73.87},
            {city:"Worcester", population:207621, lat:42.27, long:-71.81},
            {city:"Rochester", population:207274, lat:43.17, long:-77.62},
            {city:"Sioux Falls", population:206410, lat:43.54, long:-96.73},
            {city:"Little Rock", population:203842, lat:34.72, long:-92.36},
            {city:"Amarillo", population:202408, lat:35.20, long:-101.83},
            {city:"Tallahassee", population:202221, lat:30.46, long:-84.25},
            {city:"Grand Prairie", population:202134, lat:32.69, long:-97.02},
            {city:"Columbus Georgia", population:201877, lat:32.51, long:-84.87},
            {city:"Augusta", population:200884, lat:33.37, long:-82.07},
            {city:"Oxnard", population:198488, lat:34.20, long:-119.21},
            {city:"Knoxville", population:198162, lat:35.97, long:-83.95},
            {city:"Overland Park", population:197089, lat:38.89, long:-94.69},
            {city:"Birmingham", population:196644, lat:33.53, long:-86.80},
            {city:"Grand Rapids", population:196608, lat:42.96, long:-85.66},
            {city:"Vancouver", population:196442, lat:45.64, long:-122.60},
            {city:"Montgomery", population:195287, lat:32.35, long:-86.27},
            {city:"Huntington Beach", population:192129, lat:33.70, long:-118.00},
            {city:"Providence", population:190792, lat:41.82, long:-71.42},
            {city:"Brownsville", population:190158, lat:26.00, long:-97.45},
            {city:"Tempe", population:189834, lat:33.39, long:-111.93},
            {city:"Akron", population:188701, lat:41.08, long:-81.52},
            {city:"Glendale", population:187050, lat:34.18, long:-118.25},
            {city:"Chattanooga", population:187030, lat:35.07, long:-85.25},
            {city:"Fort Lauderdale", population:184255, lat:26.14, long:-80.15},
            {city:"Newport News", population:183118, lat:37.08, long:-76.52},
            {city:"Mobile", population:182595, lat:30.67, long:-88.10},
            {city:"Ontario", population:182457, lat:34.04, long:-117.60},
            {city:"Clarksville", population:180716, lat:36.57, long:-87.35},
            {city:"Cary", population:180010, lat:35.78, long:-78.82},
            {city:"Elk Grove", population:178444, lat:38.41, long:-121.38},
            {city:"Shreveport", population:177959, lat:32.47, long:-93.79},
            {city:"Eugene", population:177899, lat:44.06, long:-123.12},
            {city:"Aurora", population:177563, lat:41.76, long:-88.29},
            {city:"Salem", population:177432, lat:44.92, long:-123.02},
            {city:"Santa Rosa", population:175845, lat:38.45, long:-122.71},
            {city:"Rancho Cucamonga", population:174405, lat:34.12, long:-117.56},
            {city:"Pembroke Pines", population:171119, lat:26.01, long:-80.34},
            {city:"Fort Collins", population:170376, lat:40.55, long:-105.06},
            {city:"Springfield MO", population:170188, lat:37.19, long:-93.29},
            {city:"Oceanside", population:170020, lat:33.22, long:-117.31},
            {city:"Garden Grove", population:168234, lat:33.78, long:-117.96},
            {city:"Lancaster", population:166236, lat:34.69, long:-118.18},
            {city:"Murfreesboro", population:165430, lat:35.85, long:-86.42},
            {city:"Palmdale", population:161404, lat:34.59, long:-118.11},
            {city:"Corona", population:160238, lat:33.86, long:-117.57},
            {city:"Killeen", population:159643, lat:31.08, long:-97.73},
            {city:"Salinas", population:159506, lat:36.69, long:-121.63},
            {city:"Roseville", population:159135, lat:38.77, long:-121.32},
            {city:"Denton", population:158349, lat:33.22, long:-97.14},
            {city:"Surprise", population:158285, lat:33.67, long:-112.45},
            {city:"Macon", population:156512, lat:32.81, long:-83.69},
            {city:"Paterson", population:156452, lat:40.91, long:-74.16},
            {city:"Lakewood", population:155961, lat:39.70, long:-105.12},
            {city:"Hayward", population:155675, lat:37.63, long:-122.10},
            {city:"Charleston", population:155369, lat:32.83, long:-79.97},
            {city:"Alexandria", population:155230, lat:38.82, long:-77.08},
            {city:"Hollywood", population:153859, lat:26.03, long:-80.16},
            {city:"Springfield MA", population:153672, lat:42.12, long:-72.54},
            {city:"Kansas City", population:152933, lat:39.12, long:-94.74},
            {city:"Sunnyvale", population:151967, lat:37.39, long:-122.03},
            {city:"Bellevue", population:151574, lat:47.60, long:-122.16},
            {city:"Joliet", population:150489, lat:41.52, long:-88.15},
            {city:"Naperville", population:150245, lat:41.75, long:-88.16},
            {city:"Escondido", population:148122, lat:33.13, long:-117.07},
            {city:"Bridgeport", population:148028, lat:41.19, long:-73.20},
            {city:"Savannah", population:147748, lat:32.00, long:-81.15},
            {city:"Olathe", population:147461, lat:38.88, long:-94.82},
            {city:"Mesquite", population:147317, lat:32.76, long:-96.59},
            {city:"Pasadena TX", population:146716, lat:29.65, long:-95.15},
            {city:"McAllen", population:146593, lat:26.22, long:-98.25},
            {city:"Rockford", population:146120, lat:42.26, long:-89.06},
            {city:"Gainesville", population:145812, lat:29.68, long:-82.35},
            {city:"Syracuse", population:145560, lat:43.04, long:-76.14},
            {city:"Pomona", population:145502, lat:34.06, long:-117.76},
            {city:"Visalia", population:144998, lat:36.33, long:-119.33},
            {city:"Thornton", population:144922, lat:39.92, long:-104.94},
            {city:"Waco", population:144816, lat:31.56, long:-97.19},
            {city:"Jackson", population:143709, lat:32.32, long:-90.21},
            {city:"Columbia", population:142416, lat:34.04, long:-80.91},
            {city:"Lakewood", population:139866, lat:40.08, long:-74.20},
            {city:"Fullerton", population:139250, lat:33.89, long:-117.93},
            {city:"Torrance", population:139224, lat:33.83, long:-118.36},
            {city:"Victorville", population:138869, lat:34.53, long:-117.35},
            {city:"Midland", population:138397, lat:32.02, long:-102.11},
            {city:"Orange", population:138337, lat:33.79, long:-117.86},
            {city:"Miramar", population:138319, lat:25.97, long:-80.34},
            {city:"Hampton", population:137098, lat:37.05, long:-76.30},
            {city:"Warren", population:136655, lat:42.49, long:-83.03},
            {city:"Stamford", population:136226, lat:41.08, long:-73.55},
            {city:"Cedar Rapids", population:135958, lat:41.97, long:-91.68},
            {city:"Elizabeth", population:135829, lat:40.67, long:-74.19},
            {city:"Palm Bay", population:135566, lat:27.96, long:-80.66},
            {city:"Dayton", population:135512, lat:39.78, long:-84.20},
            {city:"New Haven", population:135319, lat:41.31, long:-72.92},
            {city:"Coral Springs", population:134906, lat:26.27, long:-80.26},
            {city:"Meridian", population:134801, lat:43.61, long:-116.40},
            {city:"West Valley City", population:134470, lat:40.69, long:-112.01},
            {city:"Pasadena CA", population:133560, lat:34.16, long:-118.14},
            {city:"Lewisville", population:133553, lat:33.05, long:-96.98},
            {city:"Kent", population:133378, lat:47.39, long:-122.21},
            {city:"Sterling Heights", population:133306, lat:42.58, long:-83.03},
            {city:"Fargo", population:133188, lat:46.86, long:-96.83},
            {city:"Carrollton", population:132918, lat:32.99, long:-96.90},
            {city:"Santa Clara", population:131062, lat:37.36, long:-121.97},
            {city:"Round Rock", population:130406, lat:30.53, long:-97.66},
            {city:"Norman", population:130046, lat:35.24, long:-97.35},
            {city:"Columbia", population:129330, lat:38.95, long:-92.33},
            {city:"Abilene", population:129043, lat:32.45, long:-99.74},
            {city:"Athens", population:128628, lat:33.95, long:-83.37},
            {city:"Pearland", population:127736, lat:29.56, long:-95.32},
            {city:"Clovis", population:125826, lat:36.83, long:-119.68},
            {city:"Topeka", population:125475, lat:39.03, long:-95.69},
            {city:"College Station", population:125192, lat:30.59, long:-96.30},
            {city:"Simi Valley", population:125113, lat:34.27, long:-118.75},
            {city:"Allentown", population:124880, lat:40.59, long:-75.48},
            {city:"West Palm Beach", population:124130, lat:26.75, long:-80.13},
            {city:"Thousand Oaks", population:123463, lat:34.19, long:-118.87},
            {city:"Vallejo", population:122807, lat:38.11, long:-122.26},
            {city:"Wilmington", population:122698, lat:34.21, long:-77.89},
            {city:"Rochester Minnesota", population:122413, lat:44.02, long:-92.48},
            {city:"Concord CA", population:122315, lat:37.97, long:-122.00},
            {city:"Lakeland", population:122264, lat:28.06, long:-81.95},
            {city:"North Charleston", population:121469, lat:32.92, long:-80.07},
            {city:"Lafayette", population:121467, lat:30.21, long:-92.03},
            {city:"Arvada", population:121414, lat:39.83, long:-105.15},
            {city:"Independence", population:120922, lat:39.09, long:-94.35},
            {city:"Billings", population:120864, lat:45.79, long:-108.55},
            {city:"Fairfield", population:120768, lat:38.26, long:-122.03},
            {city:"Hartford", population:119669, lat:41.77, long:-72.68},
            {city:"Ann Arbor", population:119381, lat:42.28, long:-83.73},
            {city:"Broken Arrow", population:119194, lat:36.04, long:-95.78},
            {city:"Berkeley", population:118962, lat:37.87, long:-122.30},
            {city:"Cambridge", population:118214, lat:42.38, long:-71.12},
            {city:"Richardson", population:117435, lat:32.97, long:-96.71},
            {city:"Antioch", population:117096, lat:37.98, long:-121.80},
            {city:"High Point", population:116926, lat:35.99, long:-79.99},
            {city:"Clearwater", population:116850, lat:27.98, long:-82.77},
            {city:"League City", population:116320, lat:29.49, long:-95.11},
            {city:"Odessa", population:115743, lat:31.88, long:-102.35},
            {city:"Manchester", population:115474, lat:42.98, long:-71.44},
            {city:"Evansville", population:115332, lat:37.99, long:-87.53},
            {city:"Waterbury", population:114990, lat:41.56, long:-73.04},
            {city:"West Jordan", population:114908, lat:40.60, long:-112.00},
            {city:"Las Cruces", population:114892, lat:32.33, long:-106.79},
            {city:"Westminster", population:114875, lat:39.88, long:-105.06},
            {city:"Lowell", population:114296, lat:42.64, long:-71.32},
            {city:"Nampa", population:114268, lat:43.58, long:-116.56},
            {city:"Richmond", population:114106, lat:37.95, long:-122.36},
            {city:"Pompano Beach", population:113619, lat:26.24, long:-80.13},
            {city:"Carlsbad", population:113495, lat:33.13, long:-117.28},
            {city:"Menifee", population:113433, lat:33.69, long:-117.18},
            {city:"Provo", population:113343, lat:40.25, long:-111.65},
            {city:"Elgin", population:113310, lat:42.04, long:-88.33},
            {city:"Greeley", population:112609, lat:40.41, long:-104.77},
            {city:"Springfield IL", population:112544, lat:39.79, long:-89.64},
            {city:"Beaumont", population:112193, lat:30.08, long:-94.15},
            {city:"Lansing", population:112115, lat:42.71, long:-84.56},
            {city:"Murrieta", population:111878, lat:33.57, long:-117.19},
            {city:"Goodyear", population:111805, lat:33.25, long:-112.37},
            {city:"Allen", population:111620, lat:33.11, long:-96.67},
            {city:"Tuscaloosa", population:111338, lat:33.23, long:-87.53},
            {city:"Everett", population:111180, lat:47.95, long:-122.19},
            {city:"Pueblo", population:111077, lat:38.27, long:-104.61},
            {city:"New Braunfels", population:110958, lat:29.70, long:-98.12},
            {city:"South Fulton", population:110920, lat:33.66, long:-84.57},
            {city:"Miami Gardens", population:110717, lat:25.95, long:-80.24},
            {city:"Gresham", population:110685, lat:45.50, long:-122.44},
            {city:"Temecula", population:110682, lat:33.49, long:-117.13},
            {city:"Rio Rancho", population:110660, lat:35.29, long:-106.70},
            {city:"Peoria", population:110460, lat:40.75, long:-89.62},
            {city:"Tyler", population:110327, lat:32.32, long:-95.31},
            {city:"Sparks", population:110323, lat:39.57, long:-119.72},
            {city:"Concord NC", population:110119, lat:35.39, long:-80.64},
            {city:"Santa Maria", population:109987, lat:34.93, long:-120.44},
            {city:"Ventura", population:109058, lat:34.27, long:-119.25},
            {city:"Buckeye", population:108909, lat:33.43, long:-112.64},
            {city:"Downey", population:108816, lat:33.94, long:-118.13},
            {city:"Sugar Land", population:108515, lat:29.59, long:-95.63},
            {city:"Costa Mesa", population:108354, lat:33.67, long:-117.91},
            {city:"Conroe", population:108248, lat:30.32, long:-95.49},
            {city:"Spokane Valley", population:108235, lat:47.66, long:-117.23},
            {city:"Davie", population:107799, lat:26.08, long:-80.28},
            {city:"Hillsboro", population:107730, lat:45.53, long:-122.94},
            {city:"Jurupa Valley", population:107321, lat:34.00, long:-117.47},
            {city:"Centennial", population:106883, lat:39.59, long:-104.87},
            {city:"Edison", population:106836, lat:40.50, long:-74.35},
            {city:"Boulder", population:105898, lat:40.02, long:-105.25},
            {city:"Dearborn", population:105811, lat:42.31, long:-83.21},
            {city:"Edinburg", population:105799, lat:26.32, long:-98.16},
            {city:"Sandy Springs", population:105793, lat:33.93, long:-84.37},
            {city:"Green Bay", population:105744, lat:44.52, long:-87.99},
            {city:"West Covina", population:105617, lat:34.06, long:-117.91},
            {city:"Brockton", population:104890, lat:42.08, long:-71.02},
            {city:"St. George", population:104578, lat:37.08, long:-113.56},
            {city:"Bend", population:104557, lat:44.06, long:-121.31},
            {city:"Renton", population:104491, lat:47.48, long:-122.19},
            {city:"Lee's Summit", population:104184, lat:38.92, long:-94.38},
            {city:"Fishers", population:104094 , lat:39.96, long:-85.97},
            {city:"El Monte", population:103794, lat:34.07, long:-118.03},
            {city:"South Bend", population:103395, lat:41.68, long:-86.27},
            {city:"Rialto", population:103391, lat:34.12, long:-117.39},
            {city:"Woodbridge", population:103194, lat:40.56, long:-74.29},
            {city:"El Cajon", population:102991, lat:32.80, long:-116.96},
            {city:"Inglewood", population:102865, lat:33.96, long:-118.34},
            {city:"Burbank", population:102755, lat:34.19, long:-118.33},
            {city:"Wichita Falls", population:102691, lat:33.91, long:-98.53},
            {city:"Vacaville", population:102526, lat:38.36, long:-121.97},
            {city:"Carmel", population:102296, lat:39.97, long:-86.15},
            {city:"Palm Coast", population:102113, lat:29.54, long:-81.24},
            {city:"Fayetteville", population:101680, lat:36.07, long:-94.17},
            {city:"Quincy", population:101597, lat:42.26, long:-71.01},
            {city:"San Mateo", population:101327, lat:37.56, long:-122.31},
            {city:"Chico", population:101301, lat:39.76, long:-121.82},
            {city:"Lynn", population:101241, lat:42.47, long:-70.96},
            {city:"Albany", population:101228, lat:42.67, long:-73.80},
            {city:"Yuma", population:100858, lat:32.52, long:-114.52},
            {city:"New Bedford", population:100695, lat:41.66, long:-70.94},
            {city:"Suffolk", population:100659, lat:36.70, long:-76.63},
            {city:"Hesperia", population:100633, lat:34.40, long:-117.32},
            {city:"Davenport", population:100354, lat:41.56, long:-90.60},
            {city:"Mexico City", lat:19.2557, long: -99.0752, population: 9209944},
            {city:"Tijuana", lat:32.3205, long: -117.0237, population: 1810645},
            {city:"Ecatepec", lat:19.3635, long: -99.0336, population: 1643623},
            {city:"León", lat:21.0711, long: -101.4050, population: 1579803},
            {city:"Puebla", lat:19.0243, long: -98.1151, population: 1542232},
            {city:"Ciudad Juárez", lat:31.4422, long: -106.2913, population: 1501551},
            {city:"Zapopan", lat:20.4314, long: -103.2318, population: 1476491},
            {city:"Guadalajara", lat:20.4035, long: -103.2032, population: 1385621},
            {city:"Monterrey", lat:25.4017, long: -100.1831, population: 1142952},
            {city:"Nezahualcóyotl", lat:19.2359, long: -98.5922, population: 1072676},
            {city:"Chihuahua", lat:28.3807, long: -106.0520, population: 925762},
            {city:"Mérida", lat:20.5804, long: -89.3718, population: 921771},
            {city:"Naucalpan", lat: 19.2831, long: -99.1416, population: 911168},
            {city:"Cancún", lat:21.0938, long: -86.5051, population: 888797},
            {city:"Saltillo", lat:25.2600, long: -101.0000, population: 864431},
            {city:"Aguascalientes", lat:21.5251, long: -102.1746, population: 863893},
            {city:"Hermosillo", lat: 29.0556, long: -110.5715, population: 855563},
            {city:"Mexicali", lat: 32.3948, long: -115.2804, population: 854186},
            {city:"San Luis Potosí", lat:22.0859, long: -100.5830, population: 845941},
            {city:"Culiacán", lat:24.4731, long: -107.2353, population: 808416},
            {city:"Querétaro", lat:20.3517, long: -100.2317, population: 794789},
            {city:"Morelia", lat:19.4208, long: -101.1108, population: 743275},
            {city:"Chimalhuacán", lat:19.2615, long: -98.5715, population: 703215},
            {city:"Reynosa", lat:26.0532, long: -98.1640, population: 691557},
            {city:"Torreón", lat:25.3240, long: -103.2630, population: 690193},
            {city:"Tlalnepantla", lat:19.3212, long: -99.1141, population: 658907},
            {city:"Acapulco", lat:16.5142, long: -99.5311, population: 658609},
            {city:"Tlaquepaque", lat:20.3819, long: -103.1826, population: 650123},
            {city:"Guadalupe", lat:25.4045, long: -100.1406, population: 635862},
            {city:"Durango", lat:24.0122, long: -104.3916, population: 616068},
            {city:"Tuxtla Gutiérrez", lat:16.4511, long: -93.0656, population: 578830},
            {city:"Cuautitlán Izcalli", lat:19.3846, long: -99.1241, population: 515353},
            {city:"Veracruz", lat: 19.1125, long: -96.0912, population: 537963},
            {city:"Ciudad Apodaca", lat:25.4654, long: -100.1120, population: 536436},
            {city:"Ciudad López Mateos", lat:19.3340, long: -99.1449, population: 523065},
            {city:"Matamoros", lat:25.5247, long: -97.3015, population: 510739},
            {city:"General Escobedo", lat:25.4831, long: -100.1937, population: 454967},
            {city:"IrapuatoIrapuato", lat:20.4027, long: -101.2051, population: 452090},
            {city:"Xalapa", lat:19.3217, long: -96.5433, population: 443063},
            {city:"Tonalá", lat:20.3724, long: -103.1444, population: 442440},
            {city:"Mazatlán", lat:23.1429, long: -106.2435, population: 441975},
            {city:"Nuevo Laredo", lat:27.2911, long: -99.3029, population: 416055},
            {city:"San Nicolás", lat:25.4430, long: -100.1808, population: 412199},
            {city:"Ojo de Agua", lat:19.4049, long: -99.0036, population: 386290},
            {city:"Xico", lat:19.1730, long: -98.5620, population: 384327},
            {city:"Celaya", lat:20.3144, long: -100.4854, population: 378143},
            {city:"Tepic", lat:21.3059, long: -104.5339, population: 371387},
            {city:"Ixtapaluca", lat:19.1907, long: -98.5256, population: 368585},
            {city:"Cuernavaca", lat:18.5507, long: -99.1403, population: 341029},
            {city:"Villahermosa", lat:17.5921, long: -92.5541, population: 340060},
            {city:"Ciudad Victoria", lat:23.4410, long: -99.0846, population: 332100},
            {city:"Ensenada", lat:31.5128, long: -116.3621, population: 330652},
            {city:"Ciudad Obregón", lat:27.2921, long: -109.5606, population: 329404},
            {city:"Ciudad Nicolás Romero", lat:19.3730, long: -99.1851, population: 323545},
            {city:"Soledad", lat:22.1059, long: -100.5627, population: 310192},
            {city:"Ciudad Benito Juárez", lat:25.3851, long: -100.0541, population: 308285},
            {city:"Playa del Carmen", lat:20.3739, long: -87.0452, population: 304942},
            {city:"Santa Catarina", lat:25.4032, long: -100.2744, population: 304052},
            {city:"Gómez Palacio", lat:25.3340, long: -103.2954, population: 301742},
            {city:"Uruapan", lat:19.2510, long: -102.0330, population: 299523},
            {city:"Los Mochis", lat:25.4737, long: -108.5949, population: 298009},
            {city:"Pachuca", lat:20.0718, long: -98.4409, population: 297848},
            {city:"Tampico", lat:22.1519, long: -97.5207, population: 297373},
            {city:"Tehuacán", lat:18.2750, long: -97.2335, population: 293825},
            {city:"San Francisco Coacalco", lat:19.3800, long: -99.0535, population: 293245},
            {city:"Nogales", lat:31.1907, long: -110.5645, population: 261137},
            {city:"Oaxaca", lat:17.0404, long: -96.4312, population: 258913},
            {city:"La Paz", lat:24.0832, long: -110.1839, population: 250141},
            {city:"Campeche", lat:19.5045, long: -90.3212, population: 249623},
            {city:"Monclova", lat:26.5403, long: -101.2500, population: 237169},
            {city:"García", lat:25.4900, long: -100.3500, population: 234698},
            {city:"Chilpancingo", lat:17.3300, long: -99.3004, population: 225728},
            {city:"Puerto Vallarta", lat:20.3649, long: -105.1338, population: 224166},
            {city:"Toluca", lat:19.1732, long: -99.3914, population: 223876},
            {city:"Tapachula", lat:14.5429, long: -92.1538, population: 217550},
            {city:"Buenavista", lat:19.3630, long: -99.1010, population: 216776},
            {city:"Coatzacoalcos", lat:18.0809, long: -94.2748, population: 212540},
            {city:"Ciudad Madero", lat:22.1635, long: -97.4953, population: 205933},
            {city:"Cabo San Lucas", lat:22.5323, long: -109.5456, population: 202694},
            {city:"Chicoloapan", lat:19.2455, long: -98.5404, population: 193532},
            {city:"Ciudad del Carmen", lat:18.3818, long: -91.5007, population: 191238},
            {city:"San Cristóba", lat:16.4412, long: -92.3818, population: 183509},
            {city:"Poza Rica", lat:20.3203, long: -97.2637, population: 180057},
            {city:"San Juan del Río", lat:20.2320, long: -99.5947, population: 177719},
            {city:"San Luis Río Colorado", lat:32.2836, long: -114.4545, population: 176685},
            {city:"Chalco", lat:19.1553, long: -98.5351, population: 174704},
            {city:"Jiutepec", lat:18.5253, long: -99.1040, population: 174629},
            {city:"Piedras Negras", lat:28.4200, long: -100.3123, population: 173959},
            {city:"Guadalupe", lat:22.4510, long: -102.3028, population: 170029},
            {city:"Chetumal", lat:18.3013, long: -88.1819, population: 169028},
            {city:"Miramar", lat:22.1959, long: -97.5159, population: 161820},
            {city:"Salamanca", lat:20.3413, long: -101.1150, population: 160682},
            {city:"Ciudad Acuña", lat:29.1927, long: -100.5554, population: 160225},
            {city:"Manzanillo", lat:19.0308, long: -104.1857, population: 159853},
            {city:"San Pablo de las Salinas", lat:19.3956, long: -99.0530, population: 157998},
            {city:"Cuautla", lat:18.4844, long: -98.5721, population: 157336},
            {city:"Zamora", lat:19.5908, long: -102.1659, population: 154546},
            {city:"Minatitlán", lat:17.5900, long: -94.3300, population: 149162},
            {city:"Villa de Álvarez", lat:19.1550, long: -103.4413, population: 147496},
            {city:"Colima", lat:19.1430, long: -103.4341, population: 146965},
            {city:"Toronto", population:4551800, lat:43.650, long:-79.380},
            {city:"Montreal", population:3256300, lat:45.520, long:-73.570},
            {city:"Vancouver", population:1836500, lat:49.280, long:-123.130},
            {city:"Calgary", population:938300, lat:51.050, long:-114.060},
            {city:"Ottawa", population:863000, lat:45.420, long:-75.710},
            {city:"Edmonton", population:812400, lat:53.570, long:-113.540},
            {city:"Hamilton", population:645100, lat:43.260, long:-79.850},
            {city:"Quebec", population:643200, lat:46.820, long:-71.230},
            {city:"Winnipeg", population:637900, lat:49.880, long:-97.170},
            {city:"Kitchener", population:403800, lat:43.460, long:-80.500},
            {city:"London", population:346900, lat:42.970, long:-81.240},
            {city:"Saint catharines-niagara", population:312700, lat:43.180, long:-79.240},
            {city:"Victoria", population:289400, lat:48.430, long:-123.370},
            {city:"Windsor", population:274400, lat:42.300, long:-83.030},
            {city:"Halifax", population:268900, lat:44.670, long:-63.610},
            {city:"Oshawa", population:244700, lat:43.890, long:-78.860},
            {city:"Gatineau", population:235000, lat:45.420, long:-75.710},
            {city:"Saskatoon", population:195000, lat:52.150, long:-106.660},
            {city:"Regina", population:174600, lat:50.450, long:-104.610},
            {city:"Barrie", population:147200, lat:44.380, long:-79.680},
            {city:"Abbotsford", population:139900, lat:49.060, long:-122.300},
            {city:"Sherbrooke", population:129000, lat:45.400, long:-71.900},
            {city:"Trois-rivieres", population:119200, lat:46.350, long:-72.570},
            {city:"Kelowna", population:116400, lat:49.890, long:-119.460},
            {city:"Saint john's", population:115400, lat:47.580, long:-52.690},
            {city:"Guelph", population:113200, lat:43.560, long:-80.260},
            {city:"Kingston", population:112700, lat:44.230, long:-76.500},
            {city:"Chicoutimi-jonquiere", population:109800, lat:48.430, long:-71.080},
            {city:"Sudbury", population:108300, lat:46.490, long:-81.010},
            {city:"Thunder bay", population:102800, lat:48.420, long:-89.280},
            {city:"Saint john", population:88700, lat:45.290, long:-66.060},
            {city:"Brantford", population:88300, lat:43.150, long:-80.260},
            {city:"Moncton", population:88300, lat:46.090, long:-64.780},
            {city:"Sarnia", population:81900, lat:42.990, long:-82.400},
            {city:"Nanaimo", population:81200, lat:49.210, long:-123.970},
            {city:"Kanata", population:79300, lat:45.340, long:-75.880},
            {city:"Peterborough", population:75900, lat:44.300, long:-78.340},
            {city:"Red deer", population:71800, lat:52.270, long:-113.830},
            {city:"Saint-jean-sur-richelieu", population:71300, lat:45.310, long:-73.260},
            {city:"Lethbridge", population:70100, lat:49.690, long:-112.830},
            {city:"Kamloops", population:68500, lat:50.680, long:-120.340},
            {city:"Sault sainte marie", population:66700, lat:46.530, long:-84.350},
            {city:"White rock", population:66400, lat:49.030, long:-122.830},
            {city:"Prince george", population:66300, lat:53.910, long:-122.770},
            {city:"Belleville", population:64500, lat:44.170, long:-77.380},
            {city:"Medicine hat", population:60300, lat:50.040, long:-110.690},
            {city:"Drummondville", population:59300, lat:45.890, long:-72.490},
            {city:"Saint-jerome", population:54700, lat:45.780, long:-74.000},
            {city:"Granby", population:53800, lat:45.410, long:-72.730},
            {city:"Fredericton", population:52800, lat:45.960, long:-66.660},
        ]

    let map;
    let currentLines = [];
    async function initMap() {
        const { Map } = await google.maps.importLibrary("maps");
        map = new Map(document.getElementById("map"), {
            zoom: 4,
            center: { lat: 40, lng: -100 },
            mapId: "Rail",
        });
        runSimulation()
    }

    function drawEdges(edges, cityPairs) {

        currentLines.forEach(line => line.setMap(null));
        currentLines = [];

        edges.forEach(e => {
            let edgeData = cityPairs.get(e.start).get(e.end);
            if (!edgeData) edgeData = cityPairs.get(e.end).get(e.start);

            const line = new google.maps.Polyline({
                path: [
                    { lat: edgeData.lat1, lng: edgeData.long1 },
                    { lat: edgeData.lat2, lng: edgeData.long2 }
                ],
                strokeColor: '#0000FF',
                strokeWeight: 2,
                map: map
            });
            currentLines.push(line);
        });
    }


    let sliderValue = 150;

    function updateValue(value) {
        sliderValue = value;
        document.getElementById('sliderValue').innerText = value;
        runSimulation()
    }

    function getSliderValue() {
        return sliderValue;
    }


    function runSimulation() {

        const threshold = getSliderValue();


        function calcDistance(lat1, long1, lat2, long2, cityA, cityB) {

            const toRadians = (degrees) => degrees * (Math.PI / 180);
            const a = Math.pow(Math.sin(toRadians(lat2 - lat1)/2), 2) + Math.cos(toRadians(lat1)) * Math.cos(toRadians(lat2)) * Math.pow(Math.sin(toRadians(long2 - long1)/2), 2);

            return 3958.8 * 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
        }


        function calcScore(distance, pop1, pop2) {
            if (distance >= 600) return 0
            else {
                if (distance < 5) return (pop1 * pop2 / 10000) / (Math.pow((5+distance*2), 2))
                else if (distance < 50) return (pop1 * pop2 / 100000) / (Math.pow((10+distance), 2))
                else return (1 - Math.abs((distance - 300) / 300)) * (pop1 * pop2 / 1000000) / (Math.pow((25+distance*0.36), 2))
            }
        }


        const cityPairs = new Map();
        for (let i=0; i<cities.length; i++) {

            const innerMap = new Map();

            for (let j=0; j<cities.length; j++) {
                if (j!==i) {
                    const lat1 = cities[i].lat
                    const long1 = cities[i].long
                    const lat2 = cities[j].lat
                    const long2 = cities[j].long
                    const distance = calcDistance(lat1, long1, lat2, long2, cities[i].city, cities[j].city)
                    const score = calcScore(distance, cities[i].population, cities[j].population)

                    innerMap.set(cities[j].city, {score, distance, lat1, long1, lat2, long2});
                }
            }
            cityPairs.set(cities[i].city, innerMap);
        }
        console.log("cityPairs", cityPairs)


        function getQualifiedCities() {
            return Array.from(cityPairs).reduce((qualifiedCities, [cityA, pairs]) => {
                if (Array.from(pairs).reduce((sum, [_, data]) => sum + data.score, 0) > threshold) qualifiedCities.push(cityA);
                return qualifiedCities;
            }, []);
        }


        function createEdges(qualifiedCities) {
            const edges = [];

            for (let cityA of qualifiedCities) {
                let connectingCities = [];

                for (let cityB of qualifiedCities) {
                    if (cityA !== cityB) {
                        let data = cityPairs.get(cityA)?.get(cityB) || cityPairs.get(cityB)?.get(cityA);

                        if (data && data.score > threshold) {
                            connectingCities.push({
                                city: cityB,
                                score: data.score
                            });
                        }
                    }
                }
                for (let connection of connectingCities) {
                    edges.push({ start: cityA, end: connection.city});
                }
            }
            return edges;
        }


         function modifiedKruskal(edges, extraEdgesLimit) {
            const parent = new Map();
                const rank = new Map();

                for (const edge of edges) {
                    if (!parent.has(edge.start)) {
                        parent.set(edge.start, edge.start);
                        rank.set(edge.start, 0);
                    }
                    if (!parent.has(edge.end)) {
                        parent.set(edge.end, edge.end);
                        rank.set(edge.end, 0);
                    }
                }

                function find(city) {
                    if (parent.get(city) !== city) parent.set(city, find(parent.get(city)));
                    return parent.get(city);
                }

                function union(cityA, cityB) {
                    const rootA = find(cityA);
                    const rootB = find(cityB);

                    if (rootA !== rootB) {
                        const rankA = rank.get(rootA);
                        const rankB = rank.get(rootB);

                        if (rankA > rankB) parent.set(rootB, rootA);
                        else if (rankA < rankB) parent.set(rootA, rootB);
                        else {
                            parent.set(rootB, rootA);
                            rank.set(rootA, rankA + 1);
                        }
                    }
                }

                edges.sort((a, b) => {
                    const dataA = cityPairs.get(a.start).get(a.end) || cityPairs.get(a.end).get(a.start);
                    const dataB = cityPairs.get(b.start).get(b.end) || cityPairs.get(b.end).get(b.start);
                    return dataB.score - dataA.score;
                });

                const mst = [];
                const extraEdges = [];
                let extraEdgesCount = 0;

                for (const edge of edges) {
                    const { start, end } = edge;

                    if (find(start) !== find(end)) {
                        mst.push(edge);
                        union(start, end);
                    }
                }

                for (const edge of edges) {
                    const { start, end } = edge;

                    if (find(start) === find(end)) {
                        const data = cityPairs.get(start).get(end) || cityPairs.get(end).get(start);
                        if (data && data.distance < 600 && extraEdgesCount < extraEdgesLimit) {
                            extraEdges.push(edge);
                            extraEdgesCount++;
                            union(start, end);
                        }
                    }

                    if (extraEdgesCount >= extraEdgesLimit) break;
                }

                const result = [...mst, ...extraEdges];
                return result;
        }


        const qualifiedCities = getQualifiedCities();
        const edges = createEdges(qualifiedCities);
        const mstEdges = modifiedKruskal(edges, edges.length*0.75)

        console.log("Qualified Cities:", qualifiedCities);
        console.log("Created Edges:", edges);
        console.log("consolidate Edges: ", mstEdges)


        drawEdges(mstEdges, cityPairs)
    }

    document.addEventListener("DOMContentLoaded", initMap);
    </script>

 <style>
        #map {
            height: 90%;
            width: 100%;
        }
        #sliderContainer {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 10%;
        }

        #slider {
            width: 50%;
        }
        #sliderText {
            color:white;
        }

        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
            background-color: black;
        }

        #modal {
            display: none;
            position: fixed;
            z-index: 1;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.4);
        }

        #modalContent {
            background-color: rgba(0,0,0,0.9);
            color: white;
            margin: 15% auto;
            padding: 20px;
            border: 1px solid #888;
            width: 80%;
            max-width: 500px;
        }

        #closeModal {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
        }

        #closeModal:hover,
        #closeModal:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }

        #infoButton {
            background-color: transparent;
            border: none;
            cursor: pointer;
            font-size: 16px;
            margin-left: 5px;
            color:white;
        }
    </style>
</head>
<body>
    <div id="map"></div>
    <div id="sliderContainer">
        <input type="range" oninput="updateValue(this.value)" id="slider" min="1" max="300" value="150" step="1">
        <p id="sliderText">Threshold: <span id="sliderValue">150</span>
            <button id="infoButton">?</button>
        </p>
    </div>

    <div id="modal">
        <div id="modalContent">
            <span id="closeModal">&times;</span>
            <h2>Passenger Rail Network Algorithm Explanation</h2>
            <p>This webpage is a visualization of a hypothetical passenger rail network algorithm.</p>
            <p>The purpose is to determine city pairings within a wider rail network at different thresholds</p>

            <h3>How the algorithm works:</h3>
            <p>The largest cities in North America are all paired with every other city and given a score based on the following gravity formula:</p>

            <ul>
                <li>
                    <strong>Cities within 5 miles:</strong>
                    <br>(population1 * population2 / 10000) / (5 + distance * 2)<sup>2</sup>
                    <br>This score represents intra-CSA light rail.
                </li>
                <li>
                    <strong>Cities within 50 miles:</strong>
                    <br>(population1 * population2 / 100000) / (10 + distance)<sup>2</sup>
                    <br>This score represents a wider metro area commuter rail.
                </li>
                <li>
                    <strong>Cities between 50 and 600 miles:</strong>
                    <br>(population1 * population2 / 1000000) / (25 + distance * 0.36)<sup>2</sup>
                    <br>This score represents high-speed rail.
                </li>
                <li>
                    <strong>Cities over 600 miles apart:</strong>
                    <br>Score = 0. It's always better to fly between long distance cities.
                </li>
            </ul>

            <p>If a city has a cumulative score (sum of all pairing scores) greater than the threshold, it is included as a qualifying city.</p>
            <p>Connections between cities are made if the pair score is greater than the threshold.</p>
            <p>Finally connections are consolidated using a modified Kruskal's algorithm which selects the top 75% highest scoring direct lines to avoid redundancy.</p>

            <h3>Limitations:</h3>
            <p>These lines are "as the crow flies". It does not account for geographic obstacles like water, mountains, or existing infrastructure. More meticulous line consolidation would be necessary in real life. For major city pairs oftentimes the calculated lines flies straight there with little attention to regional stops.</p>
        </div>
    </div>

    <script>
        const modal = document.getElementById("modal");
        const btn = document.getElementById("infoButton");
        const closeModal = document.getElementById("closeModal");

        btn.onclick = function() {
            modal.style.display = "block";
        }

        closeModal.onclick = function() {
            modal.style.display = "none";
        }

        window.onclick = function(event) {
            if (event.target == modal) modal.style.display = "none";
        }
    </script>
</body>
</html>
